{% extends 'docs/header.html' %}
{% block content %}
{% load static %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/certificate-detail.css' %}">
<style>
.certificate-seal {
    position: relative;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    padding: 20px;
    background: url("/media/Coat_of_arms_of_The_Gambia.svg") no-repeat center center;
    background-size: contain;
    color: red;
    z-index: 1; /* Ensure text stays on top of the background */
}

.certificate-seal::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.5); /* Faded white overlay */
    z-index: -1; /* Place the overlay behind the text */
}
.qr-code {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: 100px; /* Adjust size as needed */
    height: 100px;
}
</style>
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb px-3 py-2 mb-4">
        <li class="breadcrumb-item">
            <a href="{% url 'immigration_dashboard' %}" class="text-decoration-none">Dashboard</a>
        </li>
        <li class="breadcrumb-item">
            <a href="{% url 'certificate_request' %}" class="text-decoration-none">Certificate Dashboard</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">Certificate Detail</li>
    </ol>
</nav>

<!-- Header with Request Info -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2>Review Certificate Request #{{ certificate.id }}</h2>
        <p class="text-muted">Submitted on {{ certificate.submission_date|date:"F d, Y" }} at {{ certificate.submission_date|time:"H:i" }}</p>
    </div>
    <div class="badge
    {% if certificate.status == 'approved' %}bg-success{% elif certificate.status == 'rejected' %}bg-danger{% elif certificate.status == 'pending' %}bg-warning{% else %}bg-secondary{% endif %} fs-6">
    {{ certificate.status|upper }}
</div>

</div>

<div class="row">
    <!-- Certificate Preview -->
    <div class="col-lg-8">
        <div class="certificate">
            <div class="certificate-header">
                <h2>{{ certificate.get_certificate_type_display }}</h2>
                <div class="certificate-seal">SEAL</div>
            </div>
            <div class="mb-3">
                {% if certificate.certificate_type == 'birth' %}
                    <p class="text-center">This is to certify that</p>
                    <p class="text-center"><strong>{{ related_data.full_name }}</strong></p>
                    <p class="text-center">was born on</p>
                    <p class="text-center"><strong>{{ related_data.date_of_birth|date:"F d, Y" }}</strong></p>
                    <p class="text-center">in</p>
                    <p class="text-center"><strong>{{ related_data.place_of_birth }}</strong></p>
                    <p class="text-center">to</p>
                    <p class="text-center">
                        <strong>{{ related_data.father_name }}</strong> (Father) and <strong>{{ related_data.mother_name }}</strong> (Mother)
                    </p>
                    <p class="text-center mt-3">
                        Sex: <strong>{{ related_data.sex }}</strong><br>
                        Time of Birth: <strong>{{ related_data.time_of_birth }}</strong><br>
                        Birth Registration Number: <strong>{{ related_data.birth_registration_number }}</strong>
                    </p>
                {% elif certificate.certificate_type == 'marriage' %}
                    <p class="text-center">This is to certify the marriage of</p>
                    <p class="text-center"><strong>{{ related_data.spouse1_name }}</strong></p>
                    <p class="text-center">and</p>
                    <p class="text-center"><strong>{{ related_data.spouse2_name }}</strong></p>
                    <p class="text-center">on</p>
                    <p class="text-center"><strong>{{ related_data.marriage_date|date:"F d, Y" }}</strong></p>
                {% elif certificate.certificate_type == 'death' %}
                    <p class="text-center">This is to certify the death of</p>
                    <p class="text-center"><strong>{{ related_data.full_name }}</strong></p>
                    <p class="text-center">on</p>
                    <p class="text-center"><strong>{{ related_data.date_of_death|date:"F d, Y" }}</strong></p>
                    <p class="text-center">at</p>
                    <p class="text-center"><strong>{{ related_data.place_of_death }}</strong></p>
                {% elif certificate.certificate_type == 'character' %}
                    <p class="text-center">This is to certify that</p>
                    <p class="text-center"><strong>{{ related_data.full_name }}</strong></p>
                    <p class="text-center">has a record of good moral character as per our records.</p>
                {% elif certificate.certificate_type == 'academic' %}
                    <p class="text-center">This is to certify that</p>
                    <p class="text-center"><strong>{{ related_data.full_name }}</strong></p>
                    <p class="text-center">has successfully completed the requirements for</p>
                    <p class="text-center"><strong>{{ related_data.course }}</strong></p>
                    <p class="text-center">on</p>
                    <p class="text-center"><strong>{{ related_data.date_of_completion|date:"F d, Y" }}</strong></p>
                {% else %}
                    <p class="text-center">No details available for this certificate type.</p>
                {% endif %}
            </div>
            <div class="signature-line">
                <p>{{ certificate.approved_by.get_full_name }}<br>Registrar of Vital Statistics</p>
            </div>
            <!-- QR Code -->
            {% if qr_url %}
                <img src="{{ qr_url }}" alt="QR Code" class="qr-code">
            {% endif %}
        </div>
    </div>

    <!-- Review Panel -->
    <div class="col-lg-4">
        <div class="review-section p-4">
            <h4 class="mb-4">Review Details</h4>

            <!-- Applicant Information -->
            <div class="mb-4">
                <h5>Applicant Information</h5>
                <ul class="list-unstyled">
                    <li><strong>Name:</strong> {{ certificate.applicant_name }}</li>
                    <li><strong>Email:</strong> {{ certificate.applicant_email }}</li>
                    <li><strong>Phone:</strong> {{ certificate.applicant_phone }}</li>
                    <li><strong>Purpose:</strong> {{ certificate.purpose }}</li>
                </ul>
            </div>

           <!-- Supporting Documents -->
            <div class="supporting-docs mb-4">
                <h5>Supporting Documents</h5>
                {% for document in supporting_documents %}
                <div class="doc-preview">
                    <i class="fas fa-file-{{ document.attachment_type }} me-2"></i>
                    <strong>{{ document.get_attachment_type_display }}</strong>
                    <p>{{ document.description }}</p>
                    <a href="{{ document.file.url }}" class="btn btn-sm btn-link" target="_blank">View</a>
                </div>
                {% empty %}
                <p>No supporting documents provided.</p>
                {% endfor %}
            </div>


            <!-- Verification Checklist -->
            <div class="verification-checklist mb-4">
                <h5>Verification Checklist</h5>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="check1">
                    <label class="form-check-label" for="check1">
                        All required documents provided
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="check2">
                    <label class="form-check-label" for="check2">
                        Information matches records
                    </label>
                </div>
                <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="check3">
                    <label class="form-check-label" for="check3">
                        ID verification complete
                    </label>
                </div>
            </div>

            <!-- Review Notes -->
            <div class="mb-4">
                <h5>Review Notes</h5>
                <textarea class="form-control" rows="3" placeholder="Add your review notes here..."></textarea>
            </div>

            <!-- Action Buttons -->
            <div class="d-grid gap-2">
                <button class="btn btn-success">
                    <i class="fas fa-check me-2"></i>Approve Certificate
                </button>
                <button class="btn btn-danger">
                    <i class="fas fa-times me-2"></i>Reject Request
                </button>
                <button class="btn btn-secondary">
                    <i class="fas fa-clock me-2"></i>Request More Information
                </button>
            </div>
        </div>
    </div>
</div>
<br>
<br>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
{% endblock %}
