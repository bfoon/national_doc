{% include 'docs/header.html' %}
<!-- Include Font Awesome for icons and any additional CSS for styling -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

<style>
    .state-badge {
        display: inline-block;
        padding: 0.25em 0.5em;
        border-radius: 4px;
        font-size: 0.875em;
        color: #fff;
    }

    .state-pending {
        background-color: #f39c12; /* orange */
    }

    .state-processing {
        background-color: #3498db; /* blue */
    }

    .state-waiting {
        background-color: #e67e22; /* darker orange */
    }

    .state-interview {
        background-color: #8e44ad; /* purple */
    }

    .state-completed {
        background-color: #27ae60; /* green */
    }
</style>

<div class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <!-- Export Dropdown -->
        <div class="dropdown">
            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="exportDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-file-export"></i> Export as
            </button>
            <div class="dropdown-menu" aria-labelledby="exportDropdown">
                <a class="dropdown-item" href="#">PDF</a>
                <a class="dropdown-item" href="#">Excel</a>
                <a class="dropdown-item" href="#">CSV</a>
                <a class="dropdown-item" href="#">Webpage</a>
            </div>
        </div>

        <!-- Search Bar with Filter Icon -->
        <div class="d-flex align-items-center">
            <input type="text" id="searchInput" class="form-control mr-2" placeholder="Search..." style="width: 250px;">
            <button class="btn btn-outline-secondary" type="button" id="filterToggleBtn" data-toggle="collapse" data-target="#filterOptions" aria-expanded="false" aria-controls="filterOptions">
                <i class="fas fa-filter"></i> Filter
            </button>
        </div>

        <!-- Filter Dropdown -->
        <div class="dropdown">
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="fas fa-cogs"></i> Open/Close Filter
            </button>
            <div class="dropdown-menu" aria-labelledby="filterDropdown">
                <a class="dropdown-item" href="#">Open</a>
                <a class="dropdown-item" href="#">Closed</a>
            </div>
        </div>

        <!-- Button to go back to the Immigration Dashboard -->
        <a href="{% url 'immigration_dashboard' %}" class="btn btn-secondary">Back to Immigration Dashboard</a>
    </div>

    <!-- Filter Options (collapsible) -->
    <div class="collapse mb-4" id="filterOptions">
        <div class="card card-body">
            <div class="form-row">
                <div class="col-md-3">
                    <label for="dateFrom">Date From</label>
                    <input type="date" class="form-control" id="dateFrom" name="dateFrom">
                </div>
                <div class="col-md-3">
                    <label for="dateTo">Date To</label>
                    <input type="date" class="form-control" id="dateTo" name="dateTo">
                </div>
                <div class="col-md-3">
                    <label for="priority">Priority</label>
                    <select class="form-control" id="priority" name="priority">
                        <option value="">Select Priority</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label for="status">Status</label>
                    <select class="form-control" id="status" name="status">
                        <option value="">Select Status</option>
                        <option value="open">Open</option>
                        <option value="closed">Closed</option>
                        <option value="pending">Pending</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Fulfillers Table -->
    <table class="table table-striped table-hover">
        <thead class="thead-dark">
            <tr>
                <th scope="col"><input type="checkbox" id="selectAll"></th>
                <th scope="col">Title (Service)</th>
                <th scope="col">Type</th>
                <th scope="col">Location</th>
                <th scope="col">Action</th>
                <th scope="col">Schedule</th>
                <th scope="col">Priority</th>
                <th scope="col">State</th>
                <th scope="col">Status</th>
                <th scope="col">Created Date</th>
                <th scope="col">Progress</th>
            </tr>
        </thead>
        <tbody>
            {% for item in fulfillers %}
            <tr>
                <td><input type="checkbox" class="itemCheckbox"></td>
                <td>
                    <a href="{% url 'fulfiller_detail' item.id %}">
                        {{ item.application.get_service_type }}
                    </a>
                </td>
                <td>{{ item.application.application_type|capfirst }}</td>
                <td>{{ item.location }}</td>
                <td>{{ item.action }}</td>
                <td>{{ item.schedule }}</td>
                <td>{{ item.priority|capfirst }}</td>
                <td>
                    <span class="state-badge state-{{ item.application.status }}">
                        {{ item.application.status|capfirst }}
                    </span>
                </td>
                <td>{{ item.status|capfirst }}</td>
                <td>{{ item.created_at|date:"Y-m-d" }}</td>
                <td>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: {{ item.progress }}%;" aria-valuenow="{{ item.progress }}" aria-valuemin="0" aria-valuemax="100">{{ item.progress }}%</div>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="11" class="text-center">No records found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if fulfillers.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ fulfillers.previous_page_number }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}

            {% for num in fulfillers.paginator.page_range %}
            <li class="page-item {% if fulfillers.number == num %}active{% endif %}">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
            {% endfor %}

            {% if fulfillers.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ fulfillers.next_page_number }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>

{% include 'docs/footer.html' %}

<script>
    // Functionality to select all checkboxes
    document.getElementById('selectAll').addEventListener('click', function() {
        const checkboxes = document.querySelectorAll('.itemCheckbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });

    // Toggle filter icon based on collapse state
    $('#filterOptions').on('shown.bs.collapse', function () {
        $('#filterToggleBtn').html('<i class="fas fa-times"></i> Close Filter');
    });

    $('#filterOptions').on('hidden.bs.collapse', function () {
        $('#filterToggleBtn').html('<i class="fas fa-filter"></i> Filter');
    });
</script>
